<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
      <meta charset="UTF-8">
      
      <title>Image Gallery</title>
      
      <!-- Bootstrap -->
      <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" 
	type="text/css" charset="utf-8" >
      <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}"
	type="text/css" charset="utf-8" />


      <!--script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script-->
      <script type="text/javascript" src="{{ url_for('static', filename='js/jquery_1.11.1.js') }}"></script>
      <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>

      
      <script>
      
          $(document).ready(function() {

	     // When the Image is Clicked from a list of Thumbnails. 
              $('li img').on('click',function() {
                  var src = $(this).attr('src');

                  var img = '<img src="' + src + '" class="full-image "/>';

                  // Show title of the Image in Modal
                  var title = src.substring(src.lastIndexOf('uploads/'));
                  title = unescape(title.replace('uploads/', ''));
                  $("#image-title").text(title);
		  $("#hidden-file").val(unescape(title));
                  //Making the list circular and acquiring previous and next image indices
                  var index = $(this).parent('li').index();
                  var prev = index - 1;
                  var next = index + 1;
                  var total = $(this).closest('ul').children().length;
                  if (index == 0) {
                      prev =  total - 1;
                  } else if (index == total - 1) {
                     next = 0;
                  }
                  console.log(index);
		  console.log(total);
		
                  //Add Previous, next buttons to the modal
                  var htmlToAdd = '';

                  htmlToAdd += '<div class="prev-next" style="height:45px;clear:both;">';
                  
                  htmlToAdd += '<a class="controls next btn btn-lg btn-success" role="button" src="'+ (next) + '">NEXT &raquo;</a>';
                 
                  htmlToAdd += '<a class="controls previous btn btn-lg btn-success" role="button" src="' + (prev) + '">&laquo; PREVIOUS</a>';
          	  
                  htmlToAdd += '</div>';
                  htmlToAdd += img;

                  // Modal show and hide
                  $('#myModal').modal();
                  $('#myModal').modal({ keyboard: true })   // initialized with keyboard
                  $('#myModal').modal('show')                // initializes and invokes show immediately
                  // Fill modal with htmlToAdd
                  $('#myModal').on('shown.bs.modal', function(){
                      $('#myModal .modal-body').html(htmlToAdd);
                  });

                  $('#myModal').on('hidden.bs.modal', function(){
                      $('#myModal .modal-body').html('');
                  });
                  console.log($('.modal-backdrop.fade.in').css("height"));

                  $('.modal-backdrop.fade.in').css({"height":"200%"});

              });
              
              // Click controls for previous and next buttons 
              $(document).on('click', 'a.controls', function(){
                  var index = parseInt($(this).attr('src'));
                  //Test index value
                  console.log('############### ' + index);
                  var n = index + 1;
                  var src = $('ul.row li:nth-child('+ n +') img').attr('src');

                  totalImages = $('ul.row').children().length;

                  console.log();
                  //Setting index for next and previous images to be displayed when click
                  var prevIndex = index - 1;;
                  var nextIndex = index + 1;;
                  
                  // Conditions when first and last images are encountered
                  if (index == 0 ) {
                      prevIndex = totalImages - 1;
                  } else if (index == totalImages -1) {
                      nextIndex = 0;
                  }
                  
                  //Show in modal
                  $('#myModal').modal('show');
                  $('.modal-body img').attr('src', src);
                  $('.modal-backdrop.fade.in').css({"height":"200%"});

                  // Image Title in maximized view
                  var title = src.substring(src.lastIndexOf('uploads/'));
                  title = title.replace('uploads/', '');
                  $("#image-title").text(unescape(title));

		  //Resetting prevIndex and nextIndex after using previous and next buttons	
                  if($(this).hasClass('previous')) {
                      $(this).attr('src', prevIndex);
                      $('a.next').attr('src', nextIndex);
                  } else{
                      $(this).attr('src', nextIndex);
                      $('a.previous').attr('src', prevIndex);
                  }

                  return false;
                });
              // To display alert messages for 3s and then disappers
              $(".alert").show().delay(3000).fadeOut();	      

          })
      </script>

  </head>
  <body>


   <!--Header of the html page-->	
    <div class="container">
	<div class="header">	   
	    
	</div>
        <div class="jumbotron">
            <h2>Welcome to Your Image Gallery</h2>
        </div>
    </div>
    
   <!--Form for Uploading Images. Flash is used to show alert messages stored for that session-->	
    <div class="container">
        <div class="row">
            <form id="image-form" action="upload" method="post" enctype="multipart/form-data">
                <table>
                    <tr>

                        <td><input type="file" name="image" class="btn btn-default"  autocomplete="off"></td>
                        <td><input class="btn btn-default" type="submit" value="Upload"></td>
			<!--Python code embedded in html for looping over flash messages-->
                        {% with messages = get_flashed_messages() %}
				{% if messages %}
					{% for message in messages %}
                        		<td class="alert alert-warning"><strong>{{message}}</strong></td>
                        		{% endfor %}
				{% endif %}
			{% endwith %}		
                    </tr>

                </table>

            </form>
        </div>
   </div>

    <br>
    <!--To display Images as Thumbnails-->
    <div class="container image-gallery">
        <div class="jumbotron image-bar">
            <ul class="class = row list-unstyled" id="image-list">

                {% for file in files %}

                <li class="col-lg-2 col-md-2 col-sm-3 col-xs-4" id="{{file}}"><img src="{{url_for('static', filename='uploads/' + file + '')}}" alt="{{ file }}" class="thumbnail img-rounded"></li>

                {% endfor %}
            </ul>
        </div>
    </div>
     <!--To maximize the image into a bigger size. Bootstrap's Modal is used for rendering this.-->
     <div class="modal fade modal-wide" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg ">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <div class="caption">
                    <h3 id="image-title" class="modal-title">Title</h3>	  	    	    		    			    
                </div>
            </div>

            <div class="modal-body">

          </div>
          <!--Delete and Close buttons are added to the modal footer-->
          <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		<form action="remove" method="get">
			<input type="hidden" name="filename" id="hidden-file"><br>
	        	<button data-dz-remove class="btn btn-danger delete" id="delete-image"><span>Delete</span></button>
		</form>
	  </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <footer class="footer">
      <div class="container">
        <p class="text-muted" align="right">by Phani Saripalli</p>
      </div>
    </footer>





  </body>
</html>